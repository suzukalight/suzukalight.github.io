{"componentChunkName":"component---src-components-templates-blog-post-source-github-js","path":"/2019-12-08-graphql-server-mutation/","webpackCompilationHash":"9d92a21a48f2254cf2ed","result":{"data":{"site":{"siteMetadata":{"title":"suzukalight.com","author":"suzukalight"}},"markdownRemark":{"id":"9bf8d398-d76c-52bb-b191-ae2effa381c3","excerpt":"突然ですが、@suzukalight は来年からジョブチェンジして、バックエンドエンジニアとして働くことになりました！弊社の開発環境としては、Node, GraphQL, koa, apollo-server, RxJS…","html":"<p>突然ですが、<a href=\"http://twitter.com/suzukalight\" target=\"_blank\" rel=\"noopener\">@suzukalight</a> は来年からジョブチェンジして、バックエンドエンジニアとして働くことになりました！</p>\n<p>弊社の開発環境としては、Node, GraphQL, koa, apollo-server, RxJS などを採用しているのですが、順次キャッチアップするとして、まずは基本中の基本からしっかり押さえておきたいと思い、GraphQL の素振りを始めています。</p>\n<p>Apollo-Server を使った GraphQL サーバの具体的なチュートリアルとして、<a href=\"https://www.robinwieruch.de/graphql-apollo-server-tutorial\" target=\"_blank\" rel=\"noopener\">こちらの素晴らしい記事</a>がありましたので、これをなぞりつつ、typescript で記述したり、適当に改造や改善をしながら、素振りをしていこう、というのが本記事の主旨になります。なお数回のシリーズとして書いていく予定です。</p>\n<p>今回実装したリポジトリはこちらです；<br>\n<a href=\"https://github.com/suzukalight/study-graphql-apollo-server\" target=\"_blank\" rel=\"noopener\">https://github.com/suzukalight/study-graphql-apollo-server</a></p>\n<h1 id=\"セットアップとテスト実行\"><a href=\"#%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E3%81%A8%E3%83%86%E3%82%B9%E3%83%88%E5%AE%9F%E8%A1%8C\" aria-label=\"セットアップとテスト実行 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>セットアップとテスト実行</h1>\n<p>まずは GraphQL サーバのための環境をセットアップし、Playground でクエリをテスト実行できるところまでをセットアップします。</p>\n<h2 id=\"パッケージインストールと環境設定\"><a href=\"#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%A8%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A\" aria-label=\"パッケージインストールと環境設定 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>パッケージインストールと環境設定</h2>\n<p>サーバを動かすための <strong>apollo-server, express, graphql</strong> と、TypeScript で開発するための <strong>typescript, ts-node-dev</strong> をインストールします。あわせて各種設定ファイルを生成しています；</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">mkdir</span> study-graphql-apollo-server\n$ <span class=\"token function\">cd</span> study-graphql-apollo-server/\n$ <span class=\"token function\">yarn</span> init -y\n$ <span class=\"token function\">git</span> init\n$ gibo dump macos node <span class=\"token operator\">></span> .gitignore\n$ <span class=\"token function\">yarn</span> <span class=\"token function\">add</span> apollo-server apollo-server-express express graphql\n$ <span class=\"token function\">yarn</span> <span class=\"token function\">add</span> -D typescript @types/node\n$ npx tsc --init\n$ <span class=\"token function\">yarn</span> <span class=\"token function\">add</span> -D ts-node ts-node-dev</code></pre></div>\n<h2 id=\"最初のコードを書く\"><a href=\"#%E6%9C%80%E5%88%9D%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E6%9B%B8%E3%81%8F\" aria-label=\"最初のコードを書く permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>最初のコードを書く</h2>\n<p>自分自身の username を返す、me リゾルバを作成します。apollo-server ではこれらを schema, resolvers に記述して設定し、express へ紐付けて立ち上げるというフローになります；</p>\n<div class=\"gatsby-code-title\">./src.index.ts</div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> express <span class=\"token keyword\">from</span> <span class=\"token string\">'express'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> cors <span class=\"token keyword\">from</span> <span class=\"token string\">'cors'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ApolloServer<span class=\"token punctuation\">,</span> gql <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'apollo-server-express'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token function\">cors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> schema <span class=\"token operator\">=</span> gql<span class=\"token template-string\"><span class=\"token string\">`\n  type Query {\n    me: User\n  }\n\n  type User {\n    username: String!\n  }\n`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> resolvers <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  Query<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">me</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> username<span class=\"token punctuation\">:</span> <span class=\"token string\">'mkubara'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  typeDefs<span class=\"token punctuation\">:</span> schema<span class=\"token punctuation\">,</span>\n  resolvers<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nserver<span class=\"token punctuation\">.</span><span class=\"token function\">applyMiddleware</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> app<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">:</span> <span class=\"token string\">'/graphql'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> port<span class=\"token punctuation\">:</span> <span class=\"token number\">23456</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'server on http://localhost:23456/graphql'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">schema</code> でどのような情報をサーバにリクエストできるかを定義し、<code class=\"language-text\">resolvers</code> でそのリクエストをどのように解決するかの具体的な実装を記述しています。これらを apollo-server に設定して、express 上で動かせるようにしているのが、上記のコードになります。</p>\n<h2 id=\"サーバ起動とテスト実行\"><a href=\"#%E3%82%B5%E3%83%BC%E3%83%90%E8%B5%B7%E5%8B%95%E3%81%A8%E3%83%86%E3%82%B9%E3%83%88%E5%AE%9F%E8%A1%8C\" aria-label=\"サーバ起動とテスト実行 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>サーバ起動とテスト実行</h2>\n<p><code class=\"language-text\">yarn dev</code> で起動するように package.json へ記述しておきます；</p>\n<div class=\"gatsby-code-title\">package.json</div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ts-node-dev ./src/index.ts\"</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>スクリプトを実行します；</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">yarn</span> dev\n\n<span class=\"token function\">yarn</span> run v1.19.2\n$ ts-node-dev ./src/index.ts\nUsing ts-node version 8.5.4, typescript version 3.7.3\nserver on http://localhost:23456/graphql</code></pre></div>\n<p><a href=\"http://localhost:23456/graphql\" target=\"_blank\" rel=\"noopener\">http://localhost:23456/graphql</a> へアクセスすると、<strong>apollo-server に付属している GraphQL Playground が起動します。</strong>ここから API を叩けるようになっていますので、下記の query を入力して実行すれば、レスポンスが表示されるはずです；</p>\n<div class=\"gatsby-code-title\">query</div>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token punctuation\">{</span>\n  me <span class=\"token punctuation\">{</span>\n    username\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-code-title\">response</div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"data\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"me\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"username\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mkubara\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fd75ba14ffd5232d1bad97ca6bc5aa83/fea0e/playground.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 900px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABGklEQVQoz32QT0/CQBTEezERorTAdheBthBaoS0sLaCthSjRxJsHT34vT5z8quPbdiEl/jn8Mi+bzLx5a/DwHqYXoSnGuOwOiKFWDRuiaTuEiwZz/kV5jYHcQoQZ+nEOFqzAp2sITS+8Q9dPcOVGaPSnaHlzmKO/WJBnA6Pjp+j4K7Dbdand4JzWSMKRBbLXd/Aoh03LFewHOXj8AKM9WcIik0UbrLFCnnEhfDy/feDz8AUvfYKbFLiROzIXFVFxmu2IAk2fAmcJzIksT6qjzlDaoaXj9Z4MOcTiEb30BULuwZf0XenuFFY2VM1MaqbMpqdV09J67cZoBxuI+bYyl42qmc+LWmBBDXWLeqN66PGNzbIyUBl/4xj6DdUyxQRmrrjdAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"playground\"\n        title=\"\"\n        src=\"/static/fd75ba14ffd5232d1bad97ca6bc5aa83/fea0e/playground.png\"\n        srcset=\"/static/fd75ba14ffd5232d1bad97ca6bc5aa83/01387/playground.png 320w,\n/static/fd75ba14ffd5232d1bad97ca6bc5aa83/e49a9/playground.png 640w,\n/static/fd75ba14ffd5232d1bad97ca6bc5aa83/fea0e/playground.png 900w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n      />\n  </span>\n  </a></p>\n<h2 id=\"まとめ\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<ul>\n<li><strong>graphql, apollo-server, ts-node-dev でサーバを構築する</strong></li>\n<li><code class=\"language-text\">schema</code> : <strong>Query や Entity の定義を書く</strong></li>\n<li><code class=\"language-text\">resolver</code> : <strong>schema で定義したデータを解決する、具体的な実装を書く</strong></li>\n<li><code class=\"language-text\">GraphQL Playground</code> : <strong>apollo-server に付属。API のテスト実行ができる</strong></li>\n</ul>\n<h1 id=\"型定義とクエリ\"><a href=\"#%E5%9E%8B%E5%AE%9A%E7%BE%A9%E3%81%A8%E3%82%AF%E3%82%A8%E3%83%AA\" aria-label=\"型定義とクエリ permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>型定義とクエリ</h1>\n<p>最初のサンプルで返していた User エンティティを拡張していきます。今回は <code class=\"language-text\">{ id, username }</code> を持つ User エンティティの型定義を行います。</p>\n<h2 id=\"typescript-での型定義\"><a href=\"#typescript-%E3%81%A7%E3%81%AE%E5%9E%8B%E5%AE%9A%E7%BE%A9\" aria-label=\"typescript での型定義 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>typescript での型定義</h2>\n<p>interface と、サンプルデータを定義します。me は user の id=1 ということにしてみましょう；</p>\n<div class=\"gatsby-code-title\">./src/index.ts</div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">{</span>\n  id<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  username<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">Users</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> User<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> users<span class=\"token punctuation\">:</span> Users <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">'1'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">:</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> username<span class=\"token punctuation\">:</span> <span class=\"token string\">'mkubara'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'2'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">:</span> <span class=\"token string\">'2'</span><span class=\"token punctuation\">,</span> username<span class=\"token punctuation\">:</span> <span class=\"token string\">'suzukalight'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> me <span class=\"token operator\">=</span> users<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"graphql-schema-での型定義\"><a href=\"#graphql-schema-%E3%81%A7%E3%81%AE%E5%9E%8B%E5%AE%9A%E7%BE%A9\" aria-label=\"graphql schema での型定義 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>graphql schema での型定義</h2>\n<p>Query として user 全体と単体をそれぞれリクエストできるものを追加し、User には先ほど定義した id フィールドを追加します；</p>\n<div class=\"gatsby-code-title\">./src/index.ts</div>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> schema <span class=\"token operator\">=</span> gql<span class=\"token template-string\"><span class=\"token string\">`\n  type Query {\n    me: User\n<span class=\"gatsby-highlight-code-line\">    users: [User!]</span><span class=\"gatsby-highlight-code-line\">    user(id: ID!): User</span>  }\n\n  type User {\n<span class=\"gatsby-highlight-code-line\">    id: ID!</span>    username: String!\n  }\n`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">users</code> : 戻り値は配列になるため、<code class=\"language-text\">[ ]</code>で囲います。さらに配列の要素として User エンティティが返ってくることを保証するため、必須オプション <code class=\"language-text\">!</code> を付与しています。</li>\n<li><code class=\"language-text\">user(id: ID!)</code> : どの user を取得するかを指定する引数を与えられるようにしています。</li>\n</ul>\n<h2 id=\"resolvers-で具体的な実装を行う\"><a href=\"#resolvers-%E3%81%A7%E5%85%B7%E4%BD%93%E7%9A%84%E3%81%AA%E5%AE%9F%E8%A3%85%E3%82%92%E8%A1%8C%E3%81%86\" aria-label=\"resolvers で具体的な実装を行う permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>resolvers で具体的な実装を行う</h2>\n<p>User エンティティを取得するための、具体的な実装を記述していきます；</p>\n<div class=\"gatsby-code-title\">./src/index.ts</div>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ApolloServer<span class=\"token punctuation\">,</span> gql<span class=\"token punctuation\">,</span> IResolvers <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'apollo-server-express'</span><span class=\"token punctuation\">;</span></span>\n<span class=\"token keyword\">const</span> resolvers<span class=\"token punctuation\">:</span> IResolvers <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  Query<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">me</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> me<span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token function-variable function\">users</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span>users<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token function-variable function\">user</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">parent<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> id <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> users<span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span></span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">users</code> : users 全体を配列化して返しています。</li>\n<li><code class=\"language-text\">user(id: ID!)</code> : <strong>クエリから与えられた引数は、リゾルバの第 2 引数として渡されます。</strong>この値をもとに、仮想 DB から user 情報を取り出して、レスポンスとしています。</li>\n</ul>\n<h2 id=\"クエリを実行\"><a href=\"#%E3%82%AF%E3%82%A8%E3%83%AA%E3%82%92%E5%AE%9F%E8%A1%8C\" aria-label=\"クエリを実行 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>クエリを実行</h2>\n<p>作成した users, user(id) をそれぞれ実行してみます。graphql なら複数のクエリを同時に発行しても OK なので、まとめてテストしてみます；</p>\n<div class=\"gatsby-code-title\">query</div>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token punctuation\">{</span>\n  users <span class=\"token punctuation\">{</span>\n    username\n  <span class=\"token punctuation\">}</span>\n  user<span class=\"token punctuation\">(</span><span class=\"token attr-name\">id</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    id\n    username\n  <span class=\"token punctuation\">}</span>\n  me <span class=\"token punctuation\">{</span>\n    username\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-code-title\">response</div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"data\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"users\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"username\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mkubara\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"username\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"suzukalight\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"user\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"username\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"suzukalight\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"me\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"username\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mkubara\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>期待通り、users 全体と、特定の user とが、追加でリクエストできるようになりました。</p>\n<p>GraphQL がいわゆる REST API と異なるのは、欲しい情報だけを特定してリクエストすることができることと、複数の情報を一つのクエリで同時にまとめてリクエストできる点です。フロントエンドエンジニアとしては、欲しい情報を好きな形でリクエストできるようになった点に、とても柔軟性を感じたところでした。</p>\n<h2 id=\"まとめ-1\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81-1\" aria-label=\"まとめ 1 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<ul>\n<li><strong>schema で、得たい情報の型情報と、リクエストに必要な引数を定義する</strong></li>\n<li><strong>resolver の第 2 引数で、クエリ側から与えられた引数を受け取ることができ、これを使って取得したいデータを解決する</strong></li>\n<li><strong>欲しい情報だけに絞ってリクエストすることや、複数の情報を一つのクエリで同時にリクエストすることができる</strong></li>\n</ul>\n<h1 id=\"ネストした-resolver-と、context-による情報共有\"><a href=\"#%E3%83%8D%E3%82%B9%E3%83%88%E3%81%97%E3%81%9F-resolver-%E3%81%A8%E3%80%81context-%E3%81%AB%E3%82%88%E3%82%8B%E6%83%85%E5%A0%B1%E5%85%B1%E6%9C%89\" aria-label=\"ネストした resolver と、context による情報共有 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ネストした resolver と、context による情報共有</h1>\n<h2 id=\"ネストした-resolver\"><a href=\"#%E3%83%8D%E3%82%B9%E3%83%88%E3%81%97%E3%81%9F-resolver\" aria-label=\"ネストした resolver permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ネストした resolver</h2>\n<p>resolver はネストすることができます。例えばエンティティの子要素についての resolver を書くと、子要素フィールドを解決するための専用の関数を定義することができます。</p>\n<p>下記は username を上書きする例です；</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> resolvers<span class=\"token punctuation\">:</span> IResolvers <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  Query<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  User<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">username</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token string\">\"resolver name\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-code-title\">response</div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"data\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"users\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"username\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"resolver name\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"username\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"resolver name\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>上記の例では具体的なメリットはありませんが、たとえば username を firstName と lastName の合成結果にする例を作成してみましょう；</p>\n<div class=\"gatsby-code-title\">./src/index.ts</div>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> schema <span class=\"token operator\">=</span> gql<span class=\"token template-string\"><span class=\"token string\">`\n  type User {\n    id: ID!\n    username: String!\n<span class=\"gatsby-highlight-code-line\">    firstName: String!</span><span class=\"gatsby-highlight-code-line\">    lastName: String!</span>  }\n`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">{</span>\n  id<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  firstName<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  lastName<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> users<span class=\"token punctuation\">:</span> Users <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token string\">'1'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">:</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> firstName<span class=\"token punctuation\">:</span> <span class=\"token string\">'masahiko'</span><span class=\"token punctuation\">,</span> lastName<span class=\"token punctuation\">:</span> <span class=\"token string\">'kubara'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token string\">'2'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">:</span> <span class=\"token string\">'2'</span><span class=\"token punctuation\">,</span> firstName<span class=\"token punctuation\">:</span> <span class=\"token string\">'suzuka'</span><span class=\"token punctuation\">,</span> lastName<span class=\"token punctuation\">:</span> <span class=\"token string\">'light'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> resolvers<span class=\"token punctuation\">:</span> IResolvers <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  User<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token function-variable function\">username</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">user<span class=\"token punctuation\">:</span> User</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>user<span class=\"token punctuation\">.</span>firstName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>user<span class=\"token punctuation\">.</span>lastName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">,</span></span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-code-title\">response</div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"data\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"users\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"username\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"masahiko kubara\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"username\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"suzuka light\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>users 配列から username フィールドが削除されていますが、<strong>resolver によって firstName, lastName から username が合成されて、レスポンスとして返されています。</strong></p>\n<h2 id=\"context-による情報共有\"><a href=\"#context-%E3%81%AB%E3%82%88%E3%82%8B%E6%83%85%E5%A0%B1%E5%85%B1%E6%9C%89\" aria-label=\"context による情報共有 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>context による情報共有</h2>\n<p>resolver に渡される引数は全部で 4 つあります；</p>\n<ul>\n<li><strong>parent</strong>: 上位のリゾルバで解決した結果を含むオブジェクト</li>\n<li><strong>args</strong>: このリゾルバに、クエリから渡された引数</li>\n<li><strong>context</strong>: 外部から依存関係を注入するために使用する、共有引数</li>\n<li><strong>info</strong>: クエリの実行状態に関する情報</li>\n</ul>\n<p><strong>第 3 引数 context を利用すると、リゾルバ全体で共有したい情報を伝えることができます。</strong>ここではログインユーザ（me）の情報を伝えてみます；</p>\n<div class=\"gatsby-code-title\">./src/index.ts</div>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> resolvers<span class=\"token punctuation\">:</span> IResolvers <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  Query<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token function-variable function\">me</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">parent<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> me <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> me<span class=\"token punctuation\">,</span></span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  typeDefs<span class=\"token punctuation\">:</span> schema<span class=\"token punctuation\">,</span>\n  resolvers<span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">  context<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> me<span class=\"token punctuation\">:</span> users<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>context にログインユーザ情報として <code class=\"language-text\">{ me: users[2] }</code> を与えています。resolver の Query:me では、第 3 引数 context からこの情報を取り出すことで、ログインユーザとして返しています。</p>\n<h2 id=\"まとめ-2\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81-2\" aria-label=\"まとめ 2 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<ul>\n<li><strong>リゾルバをネストすることで、エンティティに直接存在しない、新しいデータを解決することができる</strong></li>\n<li><code class=\"language-text\">parent</code> : <strong>リゾルバの第 1 引数。親エンティティの情報を受け取ることができ、その情報から、ほかの情報を検索したり、新しい情報を計算できたりする</strong></li>\n<li><code class=\"language-text\">context</code> : <strong>リゾルバの第 3 引数。共有情報を受け取ることができる。ログインユーザや会社情報など</strong></li>\n</ul>\n<h1 id=\"relation\"><a href=\"#relation\" aria-label=\"relation permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>relation</h1>\n<p>GraphQL はエンティティの関係性を柔軟に記述することができるのが特徴の 1 つです。まずはその基本形として、User が Message を投稿できるという関係性を試します；</p>\n<h2 id=\"message-→-user\"><a href=\"#message-%E2%86%92-user\" aria-label=\"message → user permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Message → User</h2>\n<p>Message エンティティに userId フィールドで relation を定義します；</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">Message</span> <span class=\"token punctuation\">{</span>\n  id<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  text<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  userId<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">Messages</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> Message<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> messages<span class=\"token punctuation\">:</span> Messages <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">'1'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">:</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> text<span class=\"token punctuation\">:</span> <span class=\"token string\">'Hello, world!'</span><span class=\"token punctuation\">,</span> userId<span class=\"token punctuation\">:</span> <span class=\"token string\">'1'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'2'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">:</span> <span class=\"token string\">'2'</span><span class=\"token punctuation\">,</span> text<span class=\"token punctuation\">:</span> <span class=\"token string\">'from GraphQL and Apollo-Server.'</span><span class=\"token punctuation\">,</span> userId<span class=\"token punctuation\">:</span> <span class=\"token string\">'2'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'3'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">:</span> <span class=\"token string\">'3'</span><span class=\"token punctuation\">,</span> text<span class=\"token punctuation\">:</span> <span class=\"token string\">'textextext'</span><span class=\"token punctuation\">,</span> userId<span class=\"token punctuation\">:</span> <span class=\"token string\">'2'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>schema として <code class=\"language-text\">user: User!</code> という関係性を記述しました；</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> schema <span class=\"token operator\">=</span> gql<span class=\"token template-string\"><span class=\"token string\">`\n  type Query {\n    me: User\n    users: [User!]\n    user(id: ID!): User\n\n<span class=\"gatsby-highlight-code-line\">    messages: [Message!]!</span><span class=\"gatsby-highlight-code-line\">    message(id: ID!): Message!</span>  }\n\n<span class=\"gatsby-highlight-code-line\">  type Message {</span><span class=\"gatsby-highlight-code-line\">    id: ID!</span><span class=\"gatsby-highlight-code-line\">    text: String!</span><span class=\"gatsby-highlight-code-line\">    user: User!</span><span class=\"gatsby-highlight-code-line\">  }</span>`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>resolver でこの user に紐付けを行わせます；</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> resolvers<span class=\"token punctuation\">:</span> IResolvers <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  Query<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">me</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">parent<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> me <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> me<span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">users</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span>users<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">user</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">parent<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> id <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> users<span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token function-variable function\">messages</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span>messages<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token function-variable function\">message</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">parent<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> id <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> messages<span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  User<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">username</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">user<span class=\"token punctuation\">:</span> User</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>user<span class=\"token punctuation\">.</span>firstName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>user<span class=\"token punctuation\">.</span>lastName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">  Message<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token function-variable function\">user</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">message<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> me <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> users<span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">.</span>userId<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></span></code></pre></div>\n<p>Message に user フィールドを定義します。引数で受けた親エンティティ（Message）の userId をもとに、users データから当該 user を検索して、フィールドを解決しています。</p>\n<div class=\"gatsby-code-title\">query</div>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token punctuation\">{</span>\n  messages <span class=\"token punctuation\">{</span>\n    id\n    text\n    user <span class=\"token punctuation\">{</span>\n      id\n      username\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-code-title\">response</div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"data\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"messages\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Hello, world!\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"user\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"username\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"masahiko kubara\"</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"from GraphQL and Apollo-Server.\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"user\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"username\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"suzuka light\"</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"3\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"textextext\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"user\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"username\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"suzuka light\"</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>結果として、メッセージ一覧に加え、そのメッセージを書いたユーザに関する情報も合わせて取得することができるようになりました。</p>\n<h2 id=\"user-→-message\"><a href=\"#user-%E2%86%92-message\" aria-label=\"user → message permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>User → Message</h2>\n<p>逆方向の relation も定義できます。User に messages を追加してみます；</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> schema <span class=\"token operator\">=</span> gql<span class=\"token template-string\"><span class=\"token string\">`\n  type User {\n    ...\n<span class=\"gatsby-highlight-code-line\">    messages: [Message!]</span>  }\n`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> resolvers<span class=\"token punctuation\">:</span> IResolvers <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  User<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">username</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">user<span class=\"token punctuation\">:</span> User</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>user<span class=\"token punctuation\">.</span>firstName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>user<span class=\"token punctuation\">.</span>lastName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token function-variable function\">messages</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">user<span class=\"token punctuation\">:</span> User</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span></span><span class=\"gatsby-highlight-code-line\">      Object<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span>messages<span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">m</span> <span class=\"token operator\">=></span> <span class=\"token operator\">+</span>m<span class=\"token punctuation\">.</span>userId <span class=\"token operator\">===</span> <span class=\"token operator\">+</span>user<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">m</span> <span class=\"token operator\">=></span> messages<span class=\"token punctuation\">[</span>m<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-code-title\">query</div>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token punctuation\">{</span>\n  me <span class=\"token punctuation\">{</span>\n    id\n    username\n    messages <span class=\"token punctuation\">{</span>\n      id\n      text\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-code-title\">response</div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"data\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"me\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"username\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"suzuka light\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"messages\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"from GraphQL and Apollo-Server.\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"3\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"textextext\"</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>結果として、ユーザ情報に加え、そのユーザが書いたメッセージの一覧も合わせて取得できるようになり、逆方向の relation が記述できました。</p>\n<h1 id=\"完成品\"><a href=\"#%E5%AE%8C%E6%88%90%E5%93%81\" aria-label=\"完成品 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>完成品</h1>\n<p>実装したリポジトリはこちらです；<br>\n<a href=\"https://github.com/suzukalight/study-graphql-apollo-server\" target=\"_blank\" rel=\"noopener\">https://github.com/suzukalight/study-graphql-apollo-server</a></p>","tableOfContents":"<ul>\n<li>\n<p><a href=\"/2019-12-08-graphql-server-mutation/#%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E3%81%A8%E3%83%86%E3%82%B9%E3%83%88%E5%AE%9F%E8%A1%8C\">セットアップとテスト実行</a></p>\n<ul>\n<li><a href=\"/2019-12-08-graphql-server-mutation/#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%A8%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A\">パッケージインストールと環境設定</a></li>\n<li><a href=\"/2019-12-08-graphql-server-mutation/#%E6%9C%80%E5%88%9D%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E6%9B%B8%E3%81%8F\">最初のコードを書く</a></li>\n<li><a href=\"/2019-12-08-graphql-server-mutation/#%E3%82%B5%E3%83%BC%E3%83%90%E8%B5%B7%E5%8B%95%E3%81%A8%E3%83%86%E3%82%B9%E3%83%88%E5%AE%9F%E8%A1%8C\">サーバ起動とテスト実行</a></li>\n<li><a href=\"/2019-12-08-graphql-server-mutation/#%E3%81%BE%E3%81%A8%E3%82%81\">まとめ</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/2019-12-08-graphql-server-mutation/#%E5%9E%8B%E5%AE%9A%E7%BE%A9%E3%81%A8%E3%82%AF%E3%82%A8%E3%83%AA\">型定義とクエリ</a></p>\n<ul>\n<li><a href=\"/2019-12-08-graphql-server-mutation/#typescript-%E3%81%A7%E3%81%AE%E5%9E%8B%E5%AE%9A%E7%BE%A9\">typescript での型定義</a></li>\n<li><a href=\"/2019-12-08-graphql-server-mutation/#graphql-schema-%E3%81%A7%E3%81%AE%E5%9E%8B%E5%AE%9A%E7%BE%A9\">graphql schema での型定義</a></li>\n<li><a href=\"/2019-12-08-graphql-server-mutation/#resolvers-%E3%81%A7%E5%85%B7%E4%BD%93%E7%9A%84%E3%81%AA%E5%AE%9F%E8%A3%85%E3%82%92%E8%A1%8C%E3%81%86\">resolvers で具体的な実装を行う</a></li>\n<li><a href=\"/2019-12-08-graphql-server-mutation/#%E3%82%AF%E3%82%A8%E3%83%AA%E3%82%92%E5%AE%9F%E8%A1%8C\">クエリを実行</a></li>\n<li><a href=\"/2019-12-08-graphql-server-mutation/#%E3%81%BE%E3%81%A8%E3%82%81-1\">まとめ</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/2019-12-08-graphql-server-mutation/#%E3%83%8D%E3%82%B9%E3%83%88%E3%81%97%E3%81%9F-resolver-%E3%81%A8%E3%80%81context-%E3%81%AB%E3%82%88%E3%82%8B%E6%83%85%E5%A0%B1%E5%85%B1%E6%9C%89\">ネストした resolver と、context による情報共有</a></p>\n<ul>\n<li><a href=\"/2019-12-08-graphql-server-mutation/#%E3%83%8D%E3%82%B9%E3%83%88%E3%81%97%E3%81%9F-resolver\">ネストした resolver</a></li>\n<li><a href=\"/2019-12-08-graphql-server-mutation/#context-%E3%81%AB%E3%82%88%E3%82%8B%E6%83%85%E5%A0%B1%E5%85%B1%E6%9C%89\">context による情報共有</a></li>\n<li><a href=\"/2019-12-08-graphql-server-mutation/#%E3%81%BE%E3%81%A8%E3%82%81-2\">まとめ</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/2019-12-08-graphql-server-mutation/#relation\">relation</a></p>\n<ul>\n<li><a href=\"/2019-12-08-graphql-server-mutation/#message-%E2%86%92-user\">Message → User</a></li>\n<li><a href=\"/2019-12-08-graphql-server-mutation/#user-%E2%86%92-message\">User → Message</a></li>\n</ul>\n</li>\n<li><a href=\"/2019-12-08-graphql-server-mutation/#%E5%AE%8C%E6%88%90%E5%93%81\">完成品</a></li>\n</ul>","frontmatter":{"title":"GraphQL Apollo-Server 入門 (1)","date":"2019-12-08T00:02:00","description":null,"category":"Technology","tags":["graphql","apollo-server","express","nodejs","typescript","ts-node-dev"],"hero":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABGklEQVQoz32QT0/CQBTEezERorTAdheBthBaoS0sLaCthSjRxJsHT34vT5z8quPbdiEl/jn8Mi+bzLx5a/DwHqYXoSnGuOwOiKFWDRuiaTuEiwZz/kV5jYHcQoQZ+nEOFqzAp2sITS+8Q9dPcOVGaPSnaHlzmKO/WJBnA6Pjp+j4K7Dbdand4JzWSMKRBbLXd/Aoh03LFewHOXj8AKM9WcIik0UbrLFCnnEhfDy/feDz8AUvfYKbFLiROzIXFVFxmu2IAk2fAmcJzIksT6qjzlDaoaXj9Z4MOcTiEb30BULuwZf0XenuFFY2VM1MaqbMpqdV09J67cZoBxuI+bYyl42qmc+LWmBBDXWLeqN66PGNzbIyUBl/4xj6DdUyxQRmrrjdAAAAAElFTkSuQmCC","aspectRatio":2,"src":"/static/fd75ba14ffd5232d1bad97ca6bc5aa83/6b4f3/playground.png","srcSet":"/static/fd75ba14ffd5232d1bad97ca6bc5aa83/7b192/playground.png 320w,\n/static/fd75ba14ffd5232d1bad97ca6bc5aa83/abde0/playground.png 640w,\n/static/fd75ba14ffd5232d1bad97ca6bc5aa83/6b4f3/playground.png 900w","sizes":"(max-width: 900px) 100vw, 900px"}}}}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"source":"github","slug":"/2019-12-08-graphql-server-mutation/","previous":{"head":{"title":"Role-Based Access Control (RBAC) を実践する","category":"Technology","tags":["rbac","react","typescript"],"date":"2019-11-24T00:02:00","slug":"/2019-11-24-rbac-react-client/","source":"github"},"siteMetadata":{"title":"suzukalight.com"}},"next":{"head":{"title":"GraphQL Apollo-Server 入門 (1)","category":"Technology","tags":["graphql","apollo-server","express","nodejs","typescript","ts-node-dev"],"date":"2019-12-08T00:02:00","slug":"/2019-12-08-graphql-server/","source":"github"},"siteMetadata":{"title":"suzukalight.com"}}}}}