{"componentChunkName":"component---src-components-templates-blog-post-source-github-js","path":"/2019-08-18-monorepo-prisma2-cra-typescript/","webpackCompilationHash":"e96c72577a67475feb09","result":{"data":{"site":{"siteMetadata":{"title":"suzukalight.com","author":"suzukalight"}},"markdownRemark":{"id":"2fd6a40e-29b2-5092-983e-9359b0213414","excerpt":"Monorepo環境で、yarn workspace を使って、create-react-app —typescript した client パッケージと、prisma2 で作成した server パッケージを共存させる手順のメモです。セットアップ: yarn workspaceリポジトリ作成package.json…","html":"<p>Monorepo環境で、<strong>yarn workspace</strong> を使って、<strong>create-react-app —typescript</strong> した client パッケージと、<strong>prisma2</strong> で作成した server パッケージを共存させる手順のメモです。</p>\n<h1 id=\"セットアップ-yarn-workspace\"><a href=\"#%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97-yarn-workspace\" aria-label=\"セットアップ yarn workspace permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>セットアップ: yarn workspace</h1>\n<h2 id=\"リポジトリ作成\"><a href=\"#%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E4%BD%9C%E6%88%90\" aria-label=\"リポジトリ作成 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>リポジトリ作成</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">mkdir</span> monorepo-react-prisma2\n$ <span class=\"token function\">cd</span> monorepo-react-prisma2\n$ <span class=\"token function\">git</span> init\n$ <span class=\"token function\">yarn</span> init -y</code></pre></div>\n<h2 id=\"packagejson-で-workspace-を設定\"><a href=\"#packagejson-%E3%81%A7-workspace-%E3%82%92%E8%A8%AD%E5%AE%9A\" aria-label=\"packagejson で workspace を設定 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>package.json で workspace を設定</h2>\n<p>yarn workspace で Monorepo環境を構築する場合は、package.jsonに <code class=\"language-text\">private: true</code> と <code class=\"language-text\">workspaces: {...}</code> の2つを記述することになっています。</p>\n<ul>\n<li>packages: ワークスペースの対象となるディレクトリを指定します。ワイルドカード指定が可能です。</li>\n<li>nohoist: ワークスペース内のnpmモジュールは、デフォルトで共用になります（容量削減）。一方で共用設定をするとトラブルになってしまうようなパッケージについては、nohoistを指定することで、子パッケージ内で個別管理させることができるようになります。</li>\n</ul>\n<div class=\"gatsby-code-title\">package.json</div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"monorepo-react-prisma2\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"main\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"index.js\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"author\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"suzukalight &lt;mail@mkubara.com>\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"license\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"MIT\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"private\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"workspaces\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"packages\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"src/*\"</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"nohoist\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"**/react-scripts\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"**/react-scripts/**\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"**/@generated\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"**/@generated/**\"</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h1 id=\"client-create-react-app-typescript\"><a href=\"#client-create-react-app-typescript\" aria-label=\"client create react app typescript permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>client: create-react-app —typescript</h1>\n<p>create-react-app で TypeScript の環境を作成します；</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ npx create-react-app src/client --typescript</code></pre></div>\n<h2 id=\"yarn-workspace-client-add\"><a href=\"#yarn-workspace-client-add\" aria-label=\"yarn workspace client add permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>yarn workspace client add</h2>\n<p>クライアント側でしか使わないようなパッケージのインストールを行う場合は、<code class=\"language-text\">yarn workspace client add</code> コマンドが使えます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">yarn</span> workspace client <span class=\"token function\">add</span> node-sass</code></pre></div>\n<p>client側のpackage.jsonにのみ、設定が追加されます；</p>\n<div class=\"gatsby-code-title\">/src/client/package.json</div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"node-sass\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^4.12.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ルートのpackage.jsonに、クライアント起動コマンドを追加します；</p>\n<div class=\"gatsby-code-title\">package.json</div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"cl:start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"yarn workspace client start\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>これでクライアントの開発環境が起動できるようになりました；</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">yarn</span> cl:start</code></pre></div>\n<h1 id=\"server-prisma2\"><a href=\"#server-prisma2\" aria-label=\"server prisma2 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>server: prisma2</h1>\n<p>サーバ環境のディレクトリを作成します；</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">mkdir</span> src/server\n$ <span class=\"token function\">yarn</span> init -y</code></pre></div>\n<p><a href=\"https://github.com/prisma/photonjs/tree/master/examples/typescript/graphql\" target=\"_blank\" rel=\"noopener\">PhotonJs</a> のサンプルから、5つのファイルをコピーし、初期環境としました；</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- src/server\n    - /prisma/schema.prisma\n    - /prisma/seed.ts\n    - /src/index.ts\n    - /src/schema.graphql\n    - /src/types.ts</code></pre></div>\n<p>Lift + generate します；</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ prisma2 lift save --name <span class=\"token string\">'init'</span>\n$ prisma2 lift up\n$ <span class=\"token function\">yarn</span> seed\n$ prisma2 generate</code></pre></div>\n<p>ルートのpackage.jsonに、サーバ起動コマンドを追加します；</p>\n<div class=\"gatsby-code-title\">package.json</div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"sr:start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"yarn workspace server start\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>これでサーバの開発環境が起動できるようになりました；</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">yarn</span> sr:start</code></pre></div>\n<h1 id=\"lint--prettier\"><a href=\"#lint--prettier\" aria-label=\"lint  prettier permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Lint + Prettier</h1>\n<p>クライアントもサーバも、LintやPrettierは必ず行いますので、これらは共用モジュールとしてインストールします。そのうえで、各プロジェクトごとに個別の設定ができるよう、設定ファイルは各プロジェクトのディレクトリ配下に設置することとします。</p>\n<h2 id=\"yarn-install\"><a href=\"#yarn-install\" aria-label=\"yarn install permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>yarn install</h2>\n<ul>\n<li>eslint, prettier, plugin のインストール（React向け）</li>\n<li>TypeScript の Linting を行うために、<code class=\"language-text\">@typescript-eslint/eslint-plugin @typescript-eslint/parser</code> を追加</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">yarn</span> <span class=\"token function\">add</span> -D -W prettier eslint eslint-config-prettier eslint-plugin-prettier\n$ <span class=\"token function\">yarn</span> <span class=\"token function\">add</span> -D -W eslint-plugin-import eslint-plugin-flowtype eslint-plugin-jsx-a11y eslint-plugin-react eslint-plugin-react-hooks\n$ <span class=\"token function\">yarn</span> <span class=\"token function\">add</span> -D -W @typescript-eslint/eslint-plugin @typescript-eslint/parser</code></pre></div>\n<h2 id=\"packagejson\"><a href=\"#packagejson\" aria-label=\"packagejson permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>package.json</h2>\n<p>Lint+Prettierを行うスクリプトを、ルートのpackage.jsonに記述しておきます；</p>\n<div class=\"gatsby-code-title\">package.json</div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"lint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"yarn cl:lint &amp;&amp; yarn sr:lint\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"cl:lint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eslint --fix --ext .jsx,.js,.tsx,.ts ./src/client/src\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"sr:lint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eslint --fix --ext .jsx,.js,.tsx,.ts ./src/server/src\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"prettierrc\"><a href=\"#prettierrc\" aria-label=\"prettierrc permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>.prettierrc</h2>\n<p>各プロジェクトごとに、 <code class=\"language-text\">.prettierrc</code>, <code class=\"language-text\">.eslintrc.json</code>, <code class=\"language-text\">tsconfig.json</code> を追加していきます。prettiercは同じ内容を配置しました；</p>\n<div class=\"gatsby-code-title\">src/client/.prettierrc, src/server/.prettierrc</div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"printWidth\"</span><span class=\"token operator\">:</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"tabWidth\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"trailingComma\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"all\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"singleQuote\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"semi\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"eslintrcjson\"><a href=\"#eslintrcjson\" aria-label=\"eslintrcjson permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>.eslintrc.json</h2>\n<p>クライアント側のlint設定に、React関係のプラグイン設定を追加し、配置しました；</p>\n<div class=\"gatsby-code-title\">src/client/.eslintrc.json</div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"extends\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"eslint:recommended\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"plugin:@typescript-eslint/eslint-recommended\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"plugin:@typescript-eslint/recommended\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"plugin:prettier/recommended\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"prettier/@typescript-eslint\"</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"plugins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"@typescript-eslint\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"prettier\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"env\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token property\">\"node\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"es6\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"parser\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"@typescript-eslint/parser\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"parserOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"sourceType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"module\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"project\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./tsconfig.json\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"rules\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"prettier/prettier\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"error\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@typescript-eslint/no-var-requires\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"off\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@typescript-eslint/explicit-function-return-type\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"warn\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span> <span class=\"token property\">\"allowExpressions\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"allowTypedFunctionExpressions\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"react/jsx-uses-vars\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"warn\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"react/jsx-uses-react\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"warn\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>サーバ側はReactのプラグインは不要でしたので、それを省いて設置しました；</p>\n<div class=\"gatsby-code-title\">src/server/.eslintrc.json</div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"extends\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"eslint:recommended\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"plugin:@typescript-eslint/eslint-recommended\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"plugin:@typescript-eslint/recommended\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"plugin:prettier/recommended\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"prettier/@typescript-eslint\"</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"plugins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"@typescript-eslint\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"prettier\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"env\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token property\">\"node\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"es6\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"parser\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"@typescript-eslint/parser\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"parserOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"sourceType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"module\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"project\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./tsconfig.json\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"rules\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"prettier/prettier\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"error\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@typescript-eslint/no-var-requires\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"off\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"tsconfigjson\"><a href=\"#tsconfigjson\" aria-label=\"tsconfigjson permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>tsconfig.json</h2>\n<div class=\"gatsby-code-title\">src/client/tsconfig.json, src/server/tsconfig.json</div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"compilerOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"target\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"es5\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"lib\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"dom\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"dom.iterable\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"esnext\"</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"allowJs\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"skipLibCheck\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"esModuleInterop\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"allowSyntheticDefaultImports\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"strict\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"forceConsistentCasingInFileNames\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"module\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"esnext\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"moduleResolution\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"resolveJsonModule\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"isolatedModules\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"noEmit\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"jsx\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"include\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"src\"</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"lint--prettier-実行\"><a href=\"#lint--prettier-%E5%AE%9F%E8%A1%8C\" aria-label=\"lint  prettier 実行 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Lint + Prettier 実行</h2>\n<p>これでクライアント・サーバ両方のLint+Prettierが実行できるようになりました；</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">yarn</span> lint</code></pre></div>\n<blockquote>\n<p>もし「pluginが読み取れない」系のエラーが発生した場合は、<code class=\"language-text\">@typescript-eslint/eslint-plugin @typescript-eslint/parser</code> のバージョンを 1.3 にダウングレードしてみると良いかもしれません。</p>\n</blockquote>\n<h1 id=\"husky--lint-staged\"><a href=\"#husky--lint-staged\" aria-label=\"husky  lint staged permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Husky + lint-staged</h1>\n<p>クライアント・サーバどちらのファイルがコミットされても、huskyによってLint+Prettierが行われるように設定します；</p>\n<div class=\"gatsby-code-title\">package.json</div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"husky\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"hooks\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"pre-commit\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"lint-staged\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"lint-staged\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"./src/client/src/**/*.{js,jsx,ts,tsx}\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"eslint --fix\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"git add\"</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"./src/server/src/**/*.{js,jsx,ts,tsx}\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"eslint --fix\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"git add\"</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","tableOfContents":"<ul>\n<li>\n<p><a href=\"/2019-08-18-monorepo-prisma2-cra-typescript/#%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97-yarn-workspace\">セットアップ: yarn workspace</a></p>\n<ul>\n<li><a href=\"/2019-08-18-monorepo-prisma2-cra-typescript/#%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E4%BD%9C%E6%88%90\">リポジトリ作成</a></li>\n<li><a href=\"/2019-08-18-monorepo-prisma2-cra-typescript/#packagejson-%E3%81%A7-workspace-%E3%82%92%E8%A8%AD%E5%AE%9A\">package.json で workspace を設定</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/2019-08-18-monorepo-prisma2-cra-typescript/#client-create-react-app-typescript\">client: create-react-app —typescript</a></p>\n<ul>\n<li><a href=\"/2019-08-18-monorepo-prisma2-cra-typescript/#yarn-workspace-client-add\">yarn workspace client add</a></li>\n</ul>\n</li>\n<li><a href=\"/2019-08-18-monorepo-prisma2-cra-typescript/#server-prisma2\">server: prisma2</a></li>\n<li>\n<p><a href=\"/2019-08-18-monorepo-prisma2-cra-typescript/#lint--prettier\">Lint + Prettier</a></p>\n<ul>\n<li><a href=\"/2019-08-18-monorepo-prisma2-cra-typescript/#yarn-install\">yarn install</a></li>\n<li><a href=\"/2019-08-18-monorepo-prisma2-cra-typescript/#packagejson\">package.json</a></li>\n<li><a href=\"/2019-08-18-monorepo-prisma2-cra-typescript/#prettierrc\">.prettierrc</a></li>\n<li><a href=\"/2019-08-18-monorepo-prisma2-cra-typescript/#eslintrcjson\">.eslintrc.json</a></li>\n<li><a href=\"/2019-08-18-monorepo-prisma2-cra-typescript/#tsconfigjson\">tsconfig.json</a></li>\n<li><a href=\"/2019-08-18-monorepo-prisma2-cra-typescript/#lint--prettier-%E5%AE%9F%E8%A1%8C\">Lint + Prettier 実行</a></li>\n</ul>\n</li>\n<li><a href=\"/2019-08-18-monorepo-prisma2-cra-typescript/#husky--lint-staged\">Husky + lint-staged</a></li>\n</ul>","frontmatter":{"title":"yarn workspaceでMonorepo+TypeScript環境をつくる","date":"2019-08-18T00:02:00","description":null,"category":"Technology","tags":["monorepo","workspace","create-react-app","typescript","prisma2"],"hero":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABZUlEQVQoz42SS0/CQBSF+S/GX2HUHTExGpduXblz7dYlulMjGh/gwo2GRDcGw0IID0XRGDEaH7zaAoIKiJbXtHOcxk5ToKAnubmTmfbrOXdqAxOlVGtQ9a6p+N2A3CTg52pHKSo13tM6X9s4gMOqDYK5oxuMrgcwth2CJy6hn8xQA0j1L2pa8N1jwOHF9F4U9s0gBhe9iOcrkCo1CGUZF8IHgqk3nGXeUa4122BtQO5y0h2BfSuIYacfU7sRBjzBxnkSrss0HP5HLIeesRJ+wRJb+54KRtwuhzzy/HEcQ2unrPyY2Y9hfCeMKHPljqVxcCshXZKNEpljy8jmGYos2qznChOuMEacAawyN5oO77L4rLf6ztEysqYmUXGdLUGsytYA/CbqecvmDVW/HLB5VwoUmQSBwOpVUpATCHIZgkaddjlrc2iG8oe+qirEFEExr6CYU5B4aEFMEmT/C+w1k7/+v079AEYs8NhL+h0wAAAAAElFTkSuQmCC","aspectRatio":2.0416666666666665,"src":"/static/0daa91ffa77e9f438c7145c8e35af63f/47b96/yarn_workspace.png","srcSet":"/static/0daa91ffa77e9f438c7145c8e35af63f/d0480/yarn_workspace.png 245w,\n/static/0daa91ffa77e9f438c7145c8e35af63f/e7837/yarn_workspace.png 490w,\n/static/0daa91ffa77e9f438c7145c8e35af63f/47b96/yarn_workspace.png 980w,\n/static/0daa91ffa77e9f438c7145c8e35af63f/29476/yarn_workspace.png 1440w","sizes":"(max-width: 980px) 100vw, 980px"}}}}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"source":"github","slug":"/2019-08-18-monorepo-prisma2-cra-typescript/","previous":{"head":{"title":"GatsbyでGitHubとContentfulの複数ソースを実現する","category":"Technology","tags":["gatsby","contentful","github pages"],"date":"2019-08-14T20:00:00","slug":"/2019-08-14-gatsby-source-multiple/","source":"github"},"siteMetadata":{"title":"suzukalight.com"}},"next":{"head":{"title":"Monorepo+TypeScript+React+Storybook環境をつくる","category":"Technology","tags":["monorepo","storybook","create-react-app","typescript"],"date":"2019-08-24T00:02:00","slug":"/2019-08-24-cra-typescript-storybook/","source":"github"},"siteMetadata":{"title":"suzukalight.com"}}}}}