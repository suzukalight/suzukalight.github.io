{"componentChunkName":"component---src-components-templates-blog-post-source-github-js","path":"/2019-08-14-gatsby-source-multiple/","webpackCompilationHash":"199ae5ee624e2ce66ef8","result":{"data":{"site":{"siteMetadata":{"title":"suzukalight.com","author":"suzukalight"}},"markdownRemark":{"id":"a69b3f2e-c359-50f9-9262-d404cd053226","excerpt":"使用するパッケージContentful API との通信: Contentful のデータをソースにできるプラグイン: とを env ファイルとして保管することで、GitHub に露出させないコンテンツの変換, : Contentful の RichText を ReactNode に変換してくれる: gatsby…","html":"<h1 id=\"使用するパッケージ\"><a href=\"#%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8\" aria-label=\"使用するパッケージ permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>使用するパッケージ</h1>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> gatsby-source-contentful @contentful/rich-text-react-renderer @contentful/rich-text-types esm date-fns\n<span class=\"token function\">yarn</span> <span class=\"token function\">add</span> -D dotenv</code></pre></div>\n<h2 id=\"contentful-api-との通信\"><a href=\"#contentful-api-%E3%81%A8%E3%81%AE%E9%80%9A%E4%BF%A1\" aria-label=\"contentful api との通信 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Contentful API との通信</h2>\n<ul>\n<li><code class=\"language-text\">gatsby-source-contentful</code>: Contentful のデータをソースにできるプラグイン</li>\n<li><code class=\"language-text\">dotenv</code>: <code class=\"language-text\">CONTENTFUL_SPACE_ID</code>と<code class=\"language-text\">CONTENTFUL_ACCESS_TOKEN</code>を env ファイルとして保管することで、GitHub に露出させない</li>\n</ul>\n<h2 id=\"コンテンツの変換\"><a href=\"#%E3%82%B3%E3%83%B3%E3%83%86%E3%83%B3%E3%83%84%E3%81%AE%E5%A4%89%E6%8F%9B\" aria-label=\"コンテンツの変換 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>コンテンツの変換</h2>\n<ul>\n<li><code class=\"language-text\">@contentful/rich-text-react-renderer</code>, <code class=\"language-text\">@contentful/rich-text-types</code>: Contentful の RichText を ReactNode に変換してくれる</li>\n<li><code class=\"language-text\">esm</code>: gatsby-node.js で ES6 のモジュールを import するための変換を行う</li>\n<li><code class=\"language-text\">date-fns</code>: Contentful の Date オブジェクトの変換や、Markdown の DateString との比較を行う</li>\n</ul>\n<h1 id=\"contentful-に記事データを配置\"><a href=\"#contentful-%E3%81%AB%E8%A8%98%E4%BA%8B%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E9%85%8D%E7%BD%AE\" aria-label=\"contentful に記事データを配置 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Contentful に記事データを配置</h1>\n<h2 id=\"モデル定義\"><a href=\"#%E3%83%A2%E3%83%87%E3%83%AB%E5%AE%9A%E7%BE%A9\" aria-label=\"モデル定義 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>モデル定義</h2>\n<p>記事用のモデル、Article を定義します。フィールド名は自動で lowerCamelCase されます。</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a75a9b0ce0b4ceee9cc98bbe15589f39/5cc77/model.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 91.796875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsSAAALEgHS3X78AAACZElEQVQ4y41UW2vUQBjNq+CTD2pZrPiwrGhvYJGKV1As6g/xgiJdQ+ta1FothRZ8EPS/+eQFlO4l95lkcj1+36S7zbZZdeAkm5nM2XO+802M6dY8Gq3LaF26iemLSzg+1cKxU02cODuDk81FNBfvYO7aA8xevYczs9fRmLuNxvxdNBaWMTVzC+cWbtDafVy4sozT55dgPDU7eGSu4/nLDTxbfYvH7Vd4uNLBkxc019nE6sYO1t7tEnbQfr0N8/0nmB8+w9z6gvbGR5hvtrG2uavfW1nfgjFIInwPHfz4+QuW40EmQIFyFPvI6ZIVBfLK3GgNvFaCn404SSClhG3bkGEEX4Tw/ACBkIhUDC8IIKMIKk4QxbGeq0LF4zBYSXfg4eu33xBRAkWbLctGEAgUpMq2HSilSsX0/C8YfMmLAwvVwWvV31VU3tIYEfJUkqawVADbcSGEgE82syxHTv9U3iugTWmaaRdcKqFyuGGKlN5Ls+yA0FYSru8jpDrKMNREGRHoexX7czHVNKV9UmUIolpCQQodTSYoEF7UmyeA1bNFQYR+HWGfLLNCJospLR5/IxyWggm9OssWKXQ8D67raZWcLFvK84rVGsLScnaU0ImlttzrD7TKgILhOuV1dczGFY4spyPCDN3IJ4UuKYspmHDUEGMJHwLXcKJCXUOy7FNDCym1Op3kMJwJCsM40yqPEPaUry3v7fVg0engHvPpCCZJqnuvXuHQ8oQaskLdh0QWRaps7P9IubYPmZA/CsMa8n1SGHWWk/Rw28QC3X4fvV6/PFKUNCss7daDQwl0H3KdC034B3JjNxQ7TcHhAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"model\"\n        title=\"\"\n        src=\"/static/a75a9b0ce0b4ceee9cc98bbe15589f39/b9e4f/model.png\"\n        srcset=\"/static/a75a9b0ce0b4ceee9cc98bbe15589f39/cf440/model.png 148w,\n/static/a75a9b0ce0b4ceee9cc98bbe15589f39/d2d38/model.png 295w,\n/static/a75a9b0ce0b4ceee9cc98bbe15589f39/b9e4f/model.png 590w,\n/static/a75a9b0ce0b4ceee9cc98bbe15589f39/5cc77/model.png 768w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<h2 id=\"記事の配置\"><a href=\"#%E8%A8%98%E4%BA%8B%E3%81%AE%E9%85%8D%E7%BD%AE\" aria-label=\"記事の配置 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>記事の配置</h2>\n<p>Content メニューから、Article を1つ準備します。</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c6ccee889c8bd4d0aea07a172d670069/843d0/content.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 133.25635103926098%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAAAsSAAALEgHS3X78AAAEAElEQVRIx5VVXWsdZRDeP+CVN0UlVBDbIi0JKUJRTBWEWqm/wX9Q8ErwB3groqKNBmJoclpNKliD9MIbUyhUaSmxN8UmJ01yztmz3/vuvvv9ODNn93zEpJCFh3f23Xlnnpl3ZtaYOj2Nk29cwOnZObx06jxeePkMXjx5FideP48zFy5h5uJHOPvWZbw2+x7Ovf0hpueu0PsHmDo3h6nZy3hl5hJenXkX0+9cwak334extPwTrq3cxLfXW5hfXME3Pyzh6+8XcW2xJZj/8QYWW2tYWF6l9RYWrv+MlbXbWF77Da1f/xAsr97GjV/W0bq1DgP0aFRwkgi27aJvO+j1LViOg07PRKfbg+cH8IMQKiIdxyXtox8jjFP4oUZeVChJs0FRjuScXjJGXopekuXQaTaJJENCq+FGBZ7uutjd7aPdcQU7XRf7VijoELwoh6sywmDldz8uJhDoQr4bUVrSIR/7PRu+SqB0ViMXRIQ4LQhljQI6K0W3a3kw7QCmE5Dsw/IUjKIghSSh6J+XmUOeilJUFoSyRkFbJYyMDAZhRFBwKflufQG8ev5ozfKc8lkNDVTVgEA1RoX3iCHRDxQc10eaZaJcMIqxlcDGqhr8JEkK1/PFuRDwAoQqGhiMdSqGJiMaHT6436yjcEesDQ4lzSbDYSdNICznlJ++DmEnSqI4zNGwDrO8IKoKYRgOoZMYZocKfN+mmtOyF9Rg3SaaaiwNDYSh7/sCj3Ki4hBPNp9h/rM7+OqTdTz48wliYsbfWCcIAsntePgHGJJBUmJFz/WQ5DF+X/oLn3+8iqsXF3Dziw1x0jg9hkE6QCwirfD4/jZWv7yH7z69g4cb/yKK1TENcu2NHQiVj/sbj/D33U0qB5dyFxxp8H85zPlS5DKC4QHXdWnK7KFnduDQ9OG9cYPl8xiyt1gnUqjVgeIdtVjTGdWhrCYZUuv51Ho+tV6sNc28GHGspepZ1uQoSVPpd27PKObpWR1Zi2KQ+9Wi4crKmtiykUbmGZemmRgVBzqRg7zHDniP0TiT1mMlzuVxnsGUGrDni81rCEOLBoNHAyIlozEpheyRQo7IkSKvLAcqFjlJB5OZpzZ3GbetTYOh07fluxjkAxw2U27yFtfh8nhnJwM2mRgZBxv06A7YqKI7MPifYVk2Hjx8JNj85/Eo4XxzfMPDAVpJqBwar4yqrgAersOyUcSw3W5jZ+cZur2eyD3TxO7eHra32zDNPvWyR7nWNGx99C2L/pCO1CtXBNenRXt8Hwb/0bgk+AAXeMLlQcWrVN1uJOdjSU/pElinYcrIaKTxHterMOSxtLW1RQx3sEesnpLc7XblnRkyazY+cBbCoX82p4kZ8h4TYZkN/gfHxOrafvsmugAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"content\"\n        title=\"\"\n        src=\"/static/c6ccee889c8bd4d0aea07a172d670069/b9e4f/content.png\"\n        srcset=\"/static/c6ccee889c8bd4d0aea07a172d670069/cf440/content.png 148w,\n/static/c6ccee889c8bd4d0aea07a172d670069/d2d38/content.png 295w,\n/static/c6ccee889c8bd4d0aea07a172d670069/b9e4f/content.png 590w,\n/static/c6ccee889c8bd4d0aea07a172d670069/843d0/content.png 866w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<h1 id=\"contentful-からデータを取得\"><a href=\"#contentful-%E3%81%8B%E3%82%89%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E5%8F%96%E5%BE%97\" aria-label=\"contentful からデータを取得 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Contentful からデータを取得</h1>\n<h1 id=\"記事ページ\"><a href=\"#%E8%A8%98%E4%BA%8B%E3%83%9A%E3%83%BC%E3%82%B8\" aria-label=\"記事ページ permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>記事ページ</h1>\n<p><code class=\"language-text\">gatsby-node.js</code> で記事一覧を取得し、createPageを呼び出す処理をサンプルとして解説していきます。</p>\n<ol>\n<li>filesystem と contentful で記事のテンプレートを分ける</li>\n<li>gatsby-source-filesystem と gatsby-source-contentful の両方から記事データを同時にFetch</li>\n<li>createPage を呼び出すための下処理</li>\n</ol>\n<h2 id=\"filesystem-と-contentful-で記事のテンプレートを分ける\"><a href=\"#filesystem-%E3%81%A8-contentful-%E3%81%A7%E8%A8%98%E4%BA%8B%E3%81%AE%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%82%92%E5%88%86%E3%81%91%E3%82%8B\" aria-label=\"filesystem と contentful で記事のテンプレートを分ける permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>filesystem と contentful で記事のテンプレートを分ける</h2>\n<p>filesystemとcontentfulでは、記事ページを作成する起点となるGraphQLのクエリが異なりますので、export する pageQuery を変えるために、テンプレートファイルを分割しました；</p>\n<div class=\"gatsby-code-title\">gatsby-node.js</div>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">createPages</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> graphql<span class=\"token punctuation\">,</span> actions <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createPage <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> actions<span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> blogPostGitHubTemplate <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token template-string\"><span class=\"token string\">`./src/components/templates/BlogPost/source-github.js`</span></span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> blogPostContentfulTemplate <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token template-string\"><span class=\"token string\">`./src/components/templates/BlogPost/source-contentful.js`</span></span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>  <span class=\"token keyword\">const</span> tagTemplate <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`./src/components/templates/Tags/index.js`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> categoryTemplate <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`./src/components/templates/Categories/index.js`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Contentfulをsourceとするテンプレートファイルは、下記のようになりました（<strong>contentful + モデル名</strong>）；</p>\n<div class=\"gatsby-code-title\">components/templates/BlogPost/source-contentful.js</div>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> graphql <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> BlogPost <span class=\"token keyword\">from</span> <span class=\"token string\">'./'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> BlogPost<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> pageQuery <span class=\"token operator\">=</span> graphql<span class=\"token template-string\"><span class=\"token string\">`\n  query ContentfulBlogPostBySlug($id: String!) {\n    site {\n      siteMetadata {\n        title\n        author\n      }\n    }\n<span class=\"gatsby-highlight-code-line\">    contentfulArticle(id: { eq: $id }) {</span><span class=\"gatsby-highlight-code-line\">      id</span><span class=\"gatsby-highlight-code-line\">      slug</span><span class=\"gatsby-highlight-code-line\">      title</span><span class=\"gatsby-highlight-code-line\">      description</span><span class=\"gatsby-highlight-code-line\">      body {</span><span class=\"gatsby-highlight-code-line\">        json</span><span class=\"gatsby-highlight-code-line\">      }</span><span class=\"gatsby-highlight-code-line\">      date</span><span class=\"gatsby-highlight-code-line\">      category</span><span class=\"gatsby-highlight-code-line\">      tags</span><span class=\"gatsby-highlight-code-line\">      hero {</span><span class=\"gatsby-highlight-code-line\">        title</span><span class=\"gatsby-highlight-code-line\">        description</span><span class=\"gatsby-highlight-code-line\">        sizes(maxWidth: 1440) {</span><span class=\"gatsby-highlight-code-line\">          ...GatsbyContentfulSizes</span><span class=\"gatsby-highlight-code-line\">        }</span><span class=\"gatsby-highlight-code-line\">      }</span><span class=\"gatsby-highlight-code-line\">    }</span>  }\n`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"filesystem-と-contentful-の両方からデータをfetch\"><a href=\"#filesystem-%E3%81%A8-contentful-%E3%81%AE%E4%B8%A1%E6%96%B9%E3%81%8B%E3%82%89%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92fetch\" aria-label=\"filesystem と contentful の両方からデータをfetch permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>filesystem と contentful の両方からデータをFetch</h2>\n<p>filesystem(markdownRemark) と contentful(contentfulArticle) では、GraphQL の query が異なるため、それぞれのクエリを用いてFetchを行います。クエリ発行は1つの読み出しで可能ですので、<code class=\"language-text\">allContentfulArticle</code> を追加します（<strong>allContentful + モデル名</strong>）；</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">graphql</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`\n    {\n      site {\n        siteMetadata {\n          title\n        }\n      }\n      allMarkdownRemark(filter: { frontmatter: { status: { eq: \"published\" } } }, limit: 1000) {\n        edges {\n          node {\n            fields {\n              slug\n            }\n            frontmatter {\n              title\n              category\n              tags\n              date\n            }\n          }\n        }\n      }\n<span class=\"gatsby-highlight-code-line\">      allContentfulArticle(limit: 1000) {</span><span class=\"gatsby-highlight-code-line\">        edges {</span><span class=\"gatsby-highlight-code-line\">          node {</span><span class=\"gatsby-highlight-code-line\">            id</span><span class=\"gatsby-highlight-code-line\">            title</span><span class=\"gatsby-highlight-code-line\">            description</span><span class=\"gatsby-highlight-code-line\">            slug</span><span class=\"gatsby-highlight-code-line\">            category</span><span class=\"gatsby-highlight-code-line\">            tags</span><span class=\"gatsby-highlight-code-line\">            date</span><span class=\"gatsby-highlight-code-line\">          }</span><span class=\"gatsby-highlight-code-line\">        }</span><span class=\"gatsby-highlight-code-line\">      }</span>    }\n  `</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>result <span class=\"token operator\">||</span> result<span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> result<span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"createpage-を呼び出すための下処理\"><a href=\"#createpage-%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99%E3%81%9F%E3%82%81%E3%81%AE%E4%B8%8B%E5%87%A6%E7%90%86\" aria-label=\"createpage を呼び出すための下処理 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>createPage を呼び出すための下処理</h2>\n<p>取得したページ一覧を起点に、createPageを呼び出します。このとき行った下処理は以下のとおりです；</p>\n<ul>\n<li>取り出した記事データはsourceによってデータ構造が異なるため、適当なコンバータ(convertArticles)を作成してデータ構造を揃えた</li>\n<li>記事ページでのprev/next遷移を実現するために、記事データを公開日時でソートした</li>\n<li>sourceによって、componentに引き渡すテンプレートを振り分けた</li>\n<li>filesystemではslugで、contentfulではidで、それぞれ記事データをFetchさせるため、contextに両方を詰めた</li>\n</ul>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">  <span class=\"token comment\">// Create blog posts pages</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> posts <span class=\"token operator\">=</span> <span class=\"token function\">sortByDate</span><span class=\"token punctuation\">(</span><span class=\"token function\">convertToArticles</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>  posts<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">post<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> previous <span class=\"token operator\">=</span> index <span class=\"token operator\">===</span> posts<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token operator\">?</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">:</span> posts<span class=\"token punctuation\">[</span>index <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> next <span class=\"token operator\">=</span> index <span class=\"token operator\">===</span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">:</span> posts<span class=\"token punctuation\">[</span>index <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">,</span> slug<span class=\"token punctuation\">,</span> source <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> post<span class=\"token punctuation\">.</span>head<span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">createPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      path<span class=\"token punctuation\">:</span> slug<span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">      component<span class=\"token punctuation\">:</span> source <span class=\"token operator\">===</span> <span class=\"token string\">'github'</span> <span class=\"token operator\">?</span> blogPostGitHubTemplate <span class=\"token punctuation\">:</span> blogPostContentfulTemplate<span class=\"token punctuation\">,</span></span>      context<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">        id<span class=\"token punctuation\">,</span></span>        source<span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">        slug<span class=\"token punctuation\">,</span></span>        previous<span class=\"token punctuation\">,</span>\n        next<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"タグごとの記事一覧や、カテゴリごとの記事一覧\"><a href=\"#%E3%82%BF%E3%82%B0%E3%81%94%E3%81%A8%E3%81%AE%E8%A8%98%E4%BA%8B%E4%B8%80%E8%A6%A7%E3%82%84%E3%80%81%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%81%94%E3%81%A8%E3%81%AE%E8%A8%98%E4%BA%8B%E4%B8%80%E8%A6%A7\" aria-label=\"タグごとの記事一覧や、カテゴリごとの記事一覧 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>タグごとの記事一覧や、カテゴリごとの記事一覧</h2>\n<p>タグごとの記事一覧や、カテゴリごとの記事一覧も、さきほど取得した記事全体の情報を加工することで、作成することができます；</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">  <span class=\"token comment\">// Tag pages</span>\n  <span class=\"token keyword\">const</span> tags <span class=\"token operator\">=</span> posts<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">tags<span class=\"token punctuation\">,</span> post</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> tagsInPost <span class=\"token operator\">=</span> post<span class=\"token punctuation\">.</span>head<span class=\"token punctuation\">.</span>tags<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> tagsInPost <span class=\"token operator\">?</span> tags<span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span>tagsInPost<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> tags<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>new <span class=\"token class-name\">Set</span><span class=\"token punctuation\">(</span>tags<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">tag</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">createPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      path<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`/tags/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">kebabCase</span><span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/`</span></span><span class=\"token punctuation\">,</span>\n      component<span class=\"token punctuation\">:</span> tagTemplate<span class=\"token punctuation\">,</span>\n      context<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        tag<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h1 id=\"カテゴリリストページ\"><a href=\"#%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%83%AA%E3%82%B9%E3%83%88%E3%83%9A%E3%83%BC%E3%82%B8\" aria-label=\"カテゴリリストページ permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>カテゴリリストページ</h1>\n<p>filesystem/contentful の両方で <code class=\"language-text\">group</code> キーワードが使用できます。<code class=\"language-text\">markdown.frontmatter.category</code> と <code class=\"language-text\">contentful.category</code> の両方で、カテゴリをそれぞれgroupBy しておきます；</p>\n<div class=\"gatsby-code-title\">pages/categories.js</div>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> pageQuery <span class=\"token operator\">=</span> graphql<span class=\"token template-string\"><span class=\"token string\">`\n  query {\n    site {\n      siteMetadata {\n        title\n      }\n    }\n    allMarkdownRemark(filter: { frontmatter: { status: { eq: \"published\" } } }, limit: 2000) {\n<span class=\"gatsby-highlight-code-line\">      group(field: frontmatter___category) {</span>        fieldValue\n        totalCount\n      }\n    }\n    allContentfulArticle(limit: 2000) {\n<span class=\"gatsby-highlight-code-line\">      group(field: category) {</span>        fieldValue\n        totalCount\n      }\n    }\n  }\n`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>その結果を手計算で合成することで、全体としてのカテゴリ一覧を生成します；</p>\n<div class=\"gatsby-code-title\">pages/categories.js</div>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Categories</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> location<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> pageContext <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> site<span class=\"token punctuation\">,</span> allMarkdownRemark<span class=\"token punctuation\">,</span> allContentfulArticle <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> data <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> groups <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>allMarkdownRemark<span class=\"token punctuation\">.</span>group<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>allContentfulArticle<span class=\"token punctuation\">.</span>group<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> categoriesMap <span class=\"token operator\">=</span> groups<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cat<span class=\"token punctuation\">,</span> group</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>cat<span class=\"token punctuation\">[</span>group<span class=\"token punctuation\">.</span>fieldValue<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> cat<span class=\"token punctuation\">[</span>group<span class=\"token punctuation\">.</span>fieldValue<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    cat<span class=\"token punctuation\">[</span>group<span class=\"token punctuation\">.</span>fieldValue<span class=\"token punctuation\">]</span> <span class=\"token operator\">+=</span> group<span class=\"token punctuation\">.</span>totalCount<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">return</span> cat<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token keyword\">const</span> categories <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>categoriesMap<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> a<span class=\"token punctuation\">.</span><span class=\"token function\">localeCompare</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      fieldValue<span class=\"token punctuation\">:</span> key<span class=\"token punctuation\">,</span>\n      totalCount<span class=\"token punctuation\">:</span> categoriesMap<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>CategoriesPage location<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>location<span class=\"token punctuation\">}</span> siteMetadata<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>site<span class=\"token punctuation\">.</span>siteMetadata<span class=\"token punctuation\">}</span> categories<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>categories<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"カテゴリごとの記事一覧\"><a href=\"#%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%81%94%E3%81%A8%E3%81%AE%E8%A8%98%E4%BA%8B%E4%B8%80%E8%A6%A7\" aria-label=\"カテゴリごとの記事一覧 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>カテゴリごとの記事一覧</h2>\n<p>カテゴリに所属する記事の総数を取得したいため、<code class=\"language-text\">totalCount</code> を追加しておきます。このデータを手計算で合計することで、カテゴリに所属する記事の総数を表示します；</p>\n<div class=\"gatsby-code-title\">pages/categories.js</div>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">CategoryPage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> site<span class=\"token punctuation\">,</span> allMarkdownRemark<span class=\"token punctuation\">,</span> allContentfulArticle <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> data <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> totalCount <span class=\"token operator\">=</span> allMarkdownRemark<span class=\"token punctuation\">.</span>totalCount <span class=\"token operator\">+</span> allContentfulArticle<span class=\"token punctuation\">.</span>totalCount<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>Component <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> pageQuery <span class=\"token operator\">=</span> graphql<span class=\"token template-string\"><span class=\"token string\">`\n  query($category: String) {\n    site {\n      ...\n    }\n    allMarkdownRemark() {\n<span class=\"gatsby-highlight-code-line\">      totalCount</span>      ...\n    }\n    allContentfulArticle(limit: 2000, filter: { category: { in: [$category] } }) {\n<span class=\"gatsby-highlight-code-line\">      totalCount</span>      edges {\n        node {\n          id\n          title\n          description\n          slug\n          category\n          tags\n          date\n        }\n      }\n    }\n  }\n`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<h1 id=\"完成したページ\"><a href=\"#%E5%AE%8C%E6%88%90%E3%81%97%E3%81%9F%E3%83%9A%E3%83%BC%E3%82%B8\" aria-label=\"完成したページ permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>完成したページ</h1>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/07a1e9fb3d64c7f3975dc7168411bee3/35c67/ss1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 154%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAYAAADnTu3OAAAACXBIWXMAAAsSAAALEgHS3X78AAADdklEQVRIx51WyW4TQRDNb0BEEN8AASHEAXELfEwQHwAIDlzgL+AGEgekSFFkEErIRkhiZMeLMrbj3TP2zHiL10e9Hvd4TRRnpJK7q2uq61XVq/HCvdf3sfLxOVY+PMOjd49x++Ud3FhdxOKLpUvl5uotLIntk/dPcffVMh6+fYTlNw+wkMwmkcymUCyaIiVYZgX5YgHUp0Q/KZ798CyRSai9/l2APO1eCz+Ta9hO/0DA+I6EE8N1H+XQadj4sv8Ja8ff8PXPZ+zGN+HYLs7OzmCaJvKFPCqViiAo4tQwYIhwTynIGfX9fh+9fs9z2Gl3EAnGcLR3hH8HIRzs/sX6+jq2tn5jf28PO9s7ODw8RCgcRiAQwMbGBqLRCILBIBLiPBaPK4d+hL1eD0bCQDgSRjKVFMNjbG7+mgvqhMOuCr9WraIq4roOarUaXFnboq+6ruzraDabaDQaSupybpZMtNtt5UyLH2GhUJAXPQd0XpKKl8sVlC1LLnD9KGbJVISzDAZWXrLlwpnnE3CVw1kGk0Z0SLno8jGH+gW7YsMSeITaaDQvhXgRbN8h2yYajSJyEkEoFEZVEj7vM1YULur1OkqlkhTE9igo0bKa/M3lcqp5KTynLdclETa+VS5PQ+aLlGQypRiSzmTUBWUxpt5IJJBOp5HJZpW+Wq2pljk/P0er1ZouCg9t21YGFEbHi9h7tuOoc64pfdF7/er6fTnFlHw+LxFkJJcxlU/ylbpcLo+MRBs+OUFcKEYE1JcEKh2yZx2/T2e0DZ13Oh1fdLK57na7vn5mUTAoCg0YFcnP2+ep6ng/jjCFyU9I4unQlCJwr5N9FcqNVZlKPx9SADqzbWeMHXMNWE6bogwHRleUluCgYC8yZ6MRzuFQ+tC0VOXMgTDaUVhXpd+Qy9KDdMJfClPA3rueQ/kWsPsVZKETIZNulmXOzWe/DzU7WFnNCk4d6rnmBG82vTW57O29CU4bP0JvIW1jeZzVkBmlX3XRs0hMgyPVtwepoVPHcZVM5ZBRtWWMKcI3PT53BntGoiOfxZIxyHrB20h4QtAQR2HxTA8H9TFzPVvCnwEZ6gUaaUeEyxHFF6qq6W3lwIPpKPg6l8NvzghTeAsN2oMhoIeEToU3FNo+bHU22OtP6fATIIeRiPwTOA7CODWQkyGaSqVU4hnNVUSz6j++9zWC3aBiqwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"ss1\"\n        title=\"\"\n        src=\"/static/07a1e9fb3d64c7f3975dc7168411bee3/b9e4f/ss1.png\"\n        srcset=\"/static/07a1e9fb3d64c7f3975dc7168411bee3/cf440/ss1.png 148w,\n/static/07a1e9fb3d64c7f3975dc7168411bee3/d2d38/ss1.png 295w,\n/static/07a1e9fb3d64c7f3975dc7168411bee3/b9e4f/ss1.png 590w,\n/static/07a1e9fb3d64c7f3975dc7168411bee3/35c67/ss1.png 750w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<p><a href=\"https://suzukalight.com/2019-08-12-gatsby-source-contentful-document-sample/\" target=\"_blank\" rel=\"noopener\">https://suzukalight.com/2019-08-12-gatsby-source-contentful-document-sample/</a></p>\n<h1 id=\"tips\"><a href=\"#tips\" aria-label=\"tips permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tips</h1>\n<h2 id=\"richtextの展開\"><a href=\"#richtext%E3%81%AE%E5%B1%95%E9%96%8B\" aria-label=\"richtextの展開 permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RichTextの展開</h2>\n<blockquote>\n<p>（※注：この部分は、記事のbody部分をRichTextにした場合に、追加で必要な処理です。bodyをText(Long)にした場合は、childMarkdownRemarkによるhtml変換が利用できるため、より簡単にマークアップ処理が可能です）</p>\n</blockquote>\n<p>意外と厄介なのが、ContentfulのRichTextの処理です。記事データがJSONで構造化された状態で渡されるため、それをHTMLに変換してやる必要があります。</p>\n<div class=\"gatsby-code-title\">utils/contentful.jsx</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> documentToReactComponents <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@contentful/rich-text-react-renderer'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">BLOCKS</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@contentful/rich-text-types'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> renderOptions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  renderNode<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">[</span><span class=\"token constant\">BLOCKS</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PARAGRAPH</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">_<span class=\"token punctuation\">,</span> children</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token operator\">&lt;</span>p className<span class=\"token operator\">=</span><span class=\"token string\">\"contentful-paragraph\"</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span><span class=\"token constant\">BLOCKS</span><span class=\"token punctuation\">.</span><span class=\"token constant\">EMBEDDED_ASSET</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token parameter\">node</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> target <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span>data <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> title<span class=\"token punctuation\">,</span> description<span class=\"token punctuation\">,</span> file <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>target <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>fields <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>file<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">const</span> key1 <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> contentType<span class=\"token punctuation\">,</span> url <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> file<span class=\"token punctuation\">[</span>key1<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> mimeGroup <span class=\"token operator\">=</span> contentType<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>mimeGroup<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> <span class=\"token string\">'image'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n            <span class=\"token operator\">&lt;</span>img\n              title<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>title <span class=\"token operator\">?</span> title<span class=\"token punctuation\">[</span>key1<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">}</span>\n              alt<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>description <span class=\"token operator\">?</span> description<span class=\"token punctuation\">[</span>key1<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">}</span>\n              src<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>url<span class=\"token punctuation\">}</span>\n            <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">contentfulArticleToReactComponents</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">json</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'json'</span><span class=\"token punctuation\">,</span> json<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">documentToReactComponents</span><span class=\"token punctuation\">(</span>json<span class=\"token punctuation\">,</span> renderOptions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-code-title\">components/templates/BlogPost/index.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">BlogPostTemplate</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> location<span class=\"token punctuation\">,</span> siteMetadata<span class=\"token punctuation\">,</span> head<span class=\"token punctuation\">,</span> body<span class=\"token punctuation\">,</span> richTextJson<span class=\"token punctuation\">,</span> pageContext <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">...</span>\n      <span class=\"token punctuation\">{</span>richTextJson <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span>article<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span><span class=\"token function\">contentfulArticleToReactComponents</span><span class=\"token punctuation\">(</span>richTextJson<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">...</span></code></pre></div>\n<div class=\"gatsby-code-title\">components/templates/BlogPost/index.module.scss</div>\n<div class=\"gatsby-highlight\" data-language=\"scss\"><pre class=\"language-scss\"><code class=\"language-scss\">  <span class=\"token selector\"><span class=\"token parent important\">&amp;</span> p[class='contentful-paragraph'] </span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">white-space</span><span class=\"token punctuation\">:</span> pre-wrap<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token selector\"><span class=\"token parent important\">&amp;</span> p[class='contentful-paragraph'] > code </span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> block<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> #f2f2f2<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">white-space</span><span class=\"token punctuation\">:</span> pre-wrap<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"esm-を利用して、gatsby-nodejs-で-esm-パッケージを-import\"><a href=\"#esm-%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%A6%E3%80%81gatsby-nodejs-%E3%81%A7-esm-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92-import\" aria-label=\"esm を利用して、gatsby nodejs で esm パッケージを import permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>esm を利用して、gatsby-node.js で ESM パッケージを import</h2>\n<p>gatsby-node.js は Node 環境向けのファイルなので、そのままだと import 構文は利用できません。いくつか対策はあると思いますが、<a href=\"https://github.com/gatsbyjs/gatsby/issues/7810\" target=\"_blank\" rel=\"noopener\">こちらの Issue</a>を参考に、<code class=\"language-text\">esm</code>モジュールを利用して対応しました；</p>\n<div class=\"gatsby-code-title\">gatsby-node.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">require <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'esm'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>module<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./gatsby-node.esm.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"date-fns-を利用した、date-の扱い\"><a href=\"#date-fns-%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%80%81date-%E3%81%AE%E6%89%B1%E3%81%84\" aria-label=\"date fns を利用した、date の扱い permalink\" class=\"gatsby-autolink-headers\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>date-fns を利用した、Date の扱い</h2>\n<p>frontmatter で <code class=\"language-text\">date(formatString: &quot;YYYY/M/D&quot;)</code> として拾ってきても構わないのですが、記事のソートを日付で行いたい場合は、時刻まで拾ってきたいので、graphql での変換はいったん行わないようにします。</p>\n<p>かわりに<code class=\"language-text\">moment</code>などのライブラリで変換を行えば OK なのですが、最近は<code class=\"language-text\">date-fns</code>を採用する例も増えてきているので、これを素振りしました；</p>\n<div class=\"gatsby-code-title\">日付の\bフォーマット</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> format <span class=\"token keyword\">from</span> <span class=\"token string\">'date-fns/format'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">format</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">,</span> <span class=\"token string\">'YYYY/M/D'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-code-title\">日付の比較（ソート）</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> differenceInMilliseconds <span class=\"token keyword\">from</span> <span class=\"token string\">'date-fns/difference_in_milliseconds'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">sortByDate</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> data<span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">differenceInMilliseconds</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","tableOfContents":"<ul>\n<li>\n<p><a href=\"/2019-08-14-gatsby-source-multiple/#%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8\">使用するパッケージ</a></p>\n<ul>\n<li><a href=\"/2019-08-14-gatsby-source-multiple/#contentful-api-%E3%81%A8%E3%81%AE%E9%80%9A%E4%BF%A1\">Contentful API との通信</a></li>\n<li><a href=\"/2019-08-14-gatsby-source-multiple/#%E3%82%B3%E3%83%B3%E3%83%86%E3%83%B3%E3%83%84%E3%81%AE%E5%A4%89%E6%8F%9B\">コンテンツの変換</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/2019-08-14-gatsby-source-multiple/#contentful-%E3%81%AB%E8%A8%98%E4%BA%8B%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E9%85%8D%E7%BD%AE\">Contentful に記事データを配置</a></p>\n<ul>\n<li><a href=\"/2019-08-14-gatsby-source-multiple/#%E3%83%A2%E3%83%87%E3%83%AB%E5%AE%9A%E7%BE%A9\">モデル定義</a></li>\n<li><a href=\"/2019-08-14-gatsby-source-multiple/#%E8%A8%98%E4%BA%8B%E3%81%AE%E9%85%8D%E7%BD%AE\">記事の配置</a></li>\n</ul>\n</li>\n<li><a href=\"/2019-08-14-gatsby-source-multiple/#contentful-%E3%81%8B%E3%82%89%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E5%8F%96%E5%BE%97\">Contentful からデータを取得</a></li>\n<li>\n<p><a href=\"/2019-08-14-gatsby-source-multiple/#%E8%A8%98%E4%BA%8B%E3%83%9A%E3%83%BC%E3%82%B8\">記事ページ</a></p>\n<ul>\n<li><a href=\"/2019-08-14-gatsby-source-multiple/#filesystem-%E3%81%A8-contentful-%E3%81%A7%E8%A8%98%E4%BA%8B%E3%81%AE%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%82%92%E5%88%86%E3%81%91%E3%82%8B\">filesystem と contentful で記事のテンプレートを分ける</a></li>\n<li><a href=\"/2019-08-14-gatsby-source-multiple/#filesystem-%E3%81%A8-contentful-%E3%81%AE%E4%B8%A1%E6%96%B9%E3%81%8B%E3%82%89%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92fetch\">filesystem と contentful の両方からデータをFetch</a></li>\n<li><a href=\"/2019-08-14-gatsby-source-multiple/#createpage-%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99%E3%81%9F%E3%82%81%E3%81%AE%E4%B8%8B%E5%87%A6%E7%90%86\">createPage を呼び出すための下処理</a></li>\n<li><a href=\"/2019-08-14-gatsby-source-multiple/#%E3%82%BF%E3%82%B0%E3%81%94%E3%81%A8%E3%81%AE%E8%A8%98%E4%BA%8B%E4%B8%80%E8%A6%A7%E3%82%84%E3%80%81%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%81%94%E3%81%A8%E3%81%AE%E8%A8%98%E4%BA%8B%E4%B8%80%E8%A6%A7\">タグごとの記事一覧や、カテゴリごとの記事一覧</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/2019-08-14-gatsby-source-multiple/#%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%83%AA%E3%82%B9%E3%83%88%E3%83%9A%E3%83%BC%E3%82%B8\">カテゴリリストページ</a></p>\n<ul>\n<li><a href=\"/2019-08-14-gatsby-source-multiple/#%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%81%94%E3%81%A8%E3%81%AE%E8%A8%98%E4%BA%8B%E4%B8%80%E8%A6%A7\">カテゴリごとの記事一覧</a></li>\n</ul>\n</li>\n<li><a href=\"/2019-08-14-gatsby-source-multiple/#%E5%AE%8C%E6%88%90%E3%81%97%E3%81%9F%E3%83%9A%E3%83%BC%E3%82%B8\">完成したページ</a></li>\n<li>\n<p><a href=\"/2019-08-14-gatsby-source-multiple/#tips\">Tips</a></p>\n<ul>\n<li><a href=\"/2019-08-14-gatsby-source-multiple/#richtext%E3%81%AE%E5%B1%95%E9%96%8B\">RichTextの展開</a></li>\n<li><a href=\"/2019-08-14-gatsby-source-multiple/#esm-%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%A6%E3%80%81gatsby-nodejs-%E3%81%A7-esm-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92-import\">esm を利用して、gatsby-node.js で ESM パッケージを import</a></li>\n<li><a href=\"/2019-08-14-gatsby-source-multiple/#date-fns-%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%80%81date-%E3%81%AE%E6%89%B1%E3%81%84\">date-fns を利用した、Date の扱い</a></li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"GatsbyでGitHubとContentfulの複数ソースを実現する","date":"2019-08-14T20:00:00","description":null,"category":"Technology","tags":["gatsby","contentful","github pages"],"hero":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAQF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB25qgB//EABkQAAEFAAAAAAAAAAAAAAAAAAEDERIgMf/aAAgBAQABBQI4lN6f/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGRAAAQUAAAAAAAAAAAAAAAAAAAESICEx/9oACAEBAAY/AqFdkf/EABoQAAICAwAAAAAAAAAAAAAAAAEREEEAITH/2gAIAQEAAT8hZrVh790coDkf/9oADAMBAAIAAwAAABD/AM//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAWEQEBAQAAAAAAAAAAAAAAAAABERD/2gAIAQIBAT8QGEz/xAAbEAABBQEBAAAAAAAAAAAAAAABEBEhQVEAcf/aAAgBAQABPxCgRMtrjXfAYutAB4E//9k=","aspectRatio":2.0416666666666665,"src":"/static/1942d23e2373e55eef308f459fa50d8a/e45fd/gatsbyjs.jpg","srcSet":"/static/1942d23e2373e55eef308f459fa50d8a/2961d/gatsbyjs.jpg 245w,\n/static/1942d23e2373e55eef308f459fa50d8a/2d285/gatsbyjs.jpg 490w,\n/static/1942d23e2373e55eef308f459fa50d8a/e45fd/gatsbyjs.jpg 980w,\n/static/1942d23e2373e55eef308f459fa50d8a/d71e8/gatsbyjs.jpg 1440w","sizes":"(max-width: 980px) 100vw, 980px"}}}}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"source":"github","slug":"/2019-08-14-gatsby-source-multiple/","previous":{"head":{"id":"798fdc2a-6de9-5a03-bea4-d0e4f790c52e","title":"ContentfulのRichTextで記述したドキュメント例","description":"gatsby-source-contentful と filesystem の2つをソースとしたブログを構築","slug":"/2019-08-12-gatsby-source-contentful-document-sample/","category":"Technology","tags":["gatsby","contentful","rich text"],"date":"2019-08-12T08:00+09:00","source":"contentful"},"siteMetadata":{"title":"suzukalight.com"}},"next":{"head":{"title":"yarn workspaceでMonorepo+TypeScript環境をつくる","category":"Technology","tags":["monorepo","workspace","create-react-app","typescript","prisma2"],"date":"2019-08-18T00:02:00","slug":"/2019-08-18-monorepo-prisma2-cra-typescript/","source":"github"},"siteMetadata":{"title":"suzukalight.com"}}}}}